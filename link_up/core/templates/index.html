{% extends 'base/base.html' %}
{% load static %}

{% block content %}
    {% if not user.is_authenticated %}
    <div  class="welcome">
        <div class="login-box">
            <div class="login-logo">
                <img src="{% static 'linkup_logo.png' %}" alt="Bejelentkezés">
            </div>
            <h1>Üdvözöljük a <span class="title-hover">Link Up</span>-on!</h1>
            <hr />
            <h4><a href="{% url 'login' %}">Bejelentkezés</a> | <a href="{% url 'register' %}">Regisztráció</a></h4>
        </div>
    </div>
    {% else %}
        <div class="row p-4">
            <div class="col-md-9 col-lg-9 col-sm-12">
                <div class="card p-3 bg-dark-gray w-100 rounded" style="min-height: 70px;">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-8">
                                <textarea class="rounded bg-light-gray border-0 my-auto w-100" name="post" style="height: 40px;" placeholder="Mi jár a fejedben?" required>{{ data.post|default:'' }}</textarea>
                            </div>
                            <div class="col-2">
                                <input type="file" name="image" class="rounded bg-light-gray border-0 my-auto w-100 file" style="height: 40px;" >
                            </div>
                            <div class="col-2">
                                <button type="submit" name="add-post" class="btn btn-success my-auto" style="height: 40px;">Publikálás</button>
                            </div>
                        </div>
                        {% if profanity %}
                            <div class="alert alert-danger mt-3" role="alert">
                                    Tiltott szavakat, kifejezéseket használt, kérjük módosítsa!
                            </div>
                        {% elif error %}
                            <div class="alert alert-danger mt-3" role="alert">
                                Hiba történt, kérjük próbálkozzon újra később!
                            </div>
                        {% endif %}
                    </form>
                </div>
            </div>
            <div class="col-md-3 col-lg-3 col-sm-12">
                <div class="card p-3 bg-dark-gray w-100 rounded">
                    <div class="row">
                        <div class="col-9 my-auto user-search-text">
                            Ismerősök keresése
                        </div>
                        <div class="col-2 pe-3">
                            <i class="bi bi-search fs-3"></i>
                        </div>
                        <div class="col-12">
                            <label for="search-input"></label><input type="text" name="query" id="search-input" class="rounded bg-light-gray border-0 my-auto w-100" style="height: 40px;">
                        </div>
                        <div class="col-12 mt-3" id="search-results">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-9 col-md-9 col-sm-12">
                {% for post in posts %}
                <div class="mt-3 card p-3 bg-dark-gray w-100 rounded">
                    <div class="row">
                        <div class="col-2 my-auto">
                            <img src="{% if post.user.profilkep %}{{ post.user.profilkep.url }}{% else %}{% static 'profile.png' %}{% endif %}" alt="Profilkép" class="rounded-circle ratio-1x1 w-100">
                        </div>
                        <div class="col-10">
                            <div class="row">
                                <div class="col-8 my-auto">
                                    {{post.felhasznalo.felhasznalonev}}
                                </div>
                                <div class="col-4 my-auto">
                                    <p class="text-end">{{ post.letrehozasi_ido|date:"Y-m-d H:i" }}</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <p class="text-start">{{ post.tartalom }}</p>
                                </div>
                            </div>
                            {% if post.image %}
                                <div class="row">
                                    <div class="col-12">
                                        <img src="{{ post.feltoltott_kep }}" alt="Post" class="w-100">
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="mt-5 col-lg-3 col-md-3 col-sm-12">
                <div class="card p-3 bg-dark-gray w-100 rounded">
                    <div class="row">
                        <div class="col-12 mx-auto">
                            <p class="w-100 text-center user-search-text">Ismerősök</p>
                        </div>
                        Ide kell majd az ismerosoket felsorolni
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}
{% block scripts %}
    <script>
document.getElementById("search-input").addEventListener("input", function(e) {
    const query = e.target.value;

    fetch("{% url 'search_users' %}", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded",
            "X-CSRFToken": "{{ csrf_token }}"
        },
        body: new URLSearchParams({ query: query })
    })
    .then(response => response.text())
    .then(data => {
        document.getElementById("search-results").innerHTML = data;
    });
});
</script>
{% endblock %}
